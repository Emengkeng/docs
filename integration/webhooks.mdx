---
title: "Webhook Integration"
description: "Receive real-time notifications for subscription events"
---

## Overview

Your subscription platform sends real-time webhooks for all subscription events. This allows you to automate workflows, update your database, send notifications, and more.

## Setting Up Webhooks

<Steps>
  <Step title="Add an Endpoint">
    Navigate to the Webhooks tab of your merchant dashboard
  </Step>
  <Step title="Copy your signing secret">
    Save the secret shown during creation (displayed only once)
  </Step>
  <Step title="Verify webhook signatures">
    Implement signature verification in your endpoint handler
  </Step>
</Steps>

## Available Events

<CardGroup cols={2}>
  <Card title="subscription.created" icon="circle-plus">
    Triggered when a user subscribes to one of your plans
  </Card>
  <Card title="subscription.payment_succeeded" icon="circle-check">
    Triggered when a recurring payment is successfully processed
  </Card>
  <Card title="subscription.payment_failed" icon="circle-xmark">
    Triggered when a recurring payment fails
  </Card>
  <Card title="subscription.cancelled" icon="circle-minus">
    Triggered when a user cancels their subscription
  </Card>
</CardGroup>

### subscription.created

Triggered when a user subscribes to one of your plans.

```json
{
  "event": "subscription.created",
  "timestamp": 1701234567890,
  "data": {
    "subscription_id": "Abc123...",
    "user_wallet": "7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU",
    "plan_id": "premium-monthly-1701234567890-abc123",
    "amount_prepaid": "29000000"
  }
}
```

### subscription.payment_succeeded

Triggered when a recurring payment is successfully processed.

```json
{
  "event": "subscription.payment_succeeded",
  "timestamp": 1701234567890,
  "data": {
    "subscription_id": "Abc123...",
    "user_wallet": "7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU",
    "amount": "29000000",
    "payment_number": 2
  }
}
```

### subscription.payment_failed

Triggered when a recurring payment fails (insufficient balance, etc).

```json
{
  "event": "subscription.payment_failed",
  "timestamp": 1701234567890,
  "data": {
    "subscription_id": "Abc123...",
    "user_wallet": "7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU",
    "amount_required": "29000000",
    "balance_available": "5000000",
    "failure_count": 1
  }
}
```

### subscription.cancelled

Triggered when a user cancels their subscription.

```json
{
  "event": "subscription.cancelled",
  "timestamp": 1701234567890,
  "data": {
    "subscription_id": "Abc123...",
    "user_wallet": "7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU",
    "refund_amount": "15000000",
    "user_email": "abc@..."
    "payments_made": 3
  }
}
```

## Verifying Webhook Signatures

<Warning>
  Always verify webhook signatures to ensure the webhook came from your subscription platform.
</Warning>

<CodeGroup>

```javascript Node.js
const crypto = require('crypto');

function verifyWebhookSignature(payload, signature, secret) {
  const expectedSignature = crypto
    .createHmac('sha256', secret)
    .update(JSON.stringify(payload))
    .digest('hex');
  
  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expectedSignature)
  );
}

// In your webhook endpoint
app.post('/webhooks/subscriptions', (req, res) => {
  const signature = req.headers['x-webhook-signature'];
  const timestamp = req.headers['x-webhook-timestamp'];
  const webhookId = req.headers['x-webhook-id'];
  
  // Verify signature
  if (!verifyWebhookSignature(req.body, signature, YOUR_WEBHOOK_SECRET)) {
    return res.status(401).json({ error: 'Invalid signature' });
  }
  
  // Prevent replay attacks (optional)
  const now = Date.now();
  if (Math.abs(now - parseInt(timestamp)) > 300000) { // 5 minutes
    return res.status(401).json({ error: 'Webhook too old' });
  }
  
  // Process the webhook
  const { event, data } = req.body;
  
  switch(event) {
    case 'subscription.created':
      await grantAccess(data.user_wallet, data.plan_id);
      break;
      
    case 'subscription.payment_succeeded':
      await extendAccess(data.user_wallet);
      break;
      
    case 'subscription.payment_failed':
      await handlePaymentFailure(data.user_wallet, data.failure_count);
      break;
      
    case 'subscription.cancelled':
      await revokeAccess(data.user_wallet);
      break;
  }
  
  res.json({ received: true });
});
```


```python Python
import hmac
import hashlib
import json
from flask import Flask, request

app = Flask(__name__)

WEBHOOK_SECRET = 'your_webhook_secret_here'

def verify_signature(payload, signature, secret):
    expected = hmac.new(
        secret.encode(),
        json.dumps(payload).encode(),
        hashlib.sha256
    ).hexdigest()
    return hmac.compare_digest(signature, expected)

@app.route('/webhooks/subscriptions', methods=['POST'])
def handle_webhook():
    signature = request.headers.get('X-Webhook-Signature')
    timestamp = request.headers.get('X-Webhook-Timestamp')
    payload = request.json
    
    if not verify_signature(payload, signature, WEBHOOK_SECRET):
        return {'error': 'Invalid signature'}, 401
    
    event = payload['event']
    data = payload['data']
    
    if event == 'subscription.created':
        grant_access(data['user_wallet'], data['plan_id'])
    elif event == 'subscription.payment_succeeded':
        extend_access(data['user_wallet'])
    elif event == 'subscription.payment_failed':
        handle_payment_failure(data['user_wallet'], data['failure_count'])
    elif event == 'subscription.cancelled':
        revoke_access(data['user_wallet'])
    
    return {'received': True}
```

</CodeGroup>

## Best Practices

<AccordionGroup>
  <Accordion title="Always verify signatures" icon="shield-check">
    Never trust unverified webhooks. Always implement signature verification.
  </Accordion>
  <Accordion title="Process webhooks asynchronously" icon="clock">
    Respond quickly (\< 10s) and process in background to avoid timeouts.
  </Accordion>
  <Accordion title="Handle duplicates" icon="copy">
    Use `x-webhook-id` header to deduplicate events.
  </Accordion>
  <Accordion title="Check timestamps" icon="calendar">
    Reject old webhooks to prevent replay attacks.
  </Accordion>
  <Accordion title="Return 200 quickly" icon="check">
    We'll retry on timeouts or 5xx errors.
  </Accordion>
  <Accordion title="Monitor your endpoint" icon="chart-line">
    Check the Webhooks tab for delivery failures.
  </Accordion>
</AccordionGroup>

## Retry Policy

Failed webhooks are automatically retried with exponential backoff:

<Steps>
  <Step title="1st retry">
    After 1 minute
  </Step>
  <Step title="2nd retry">
    After 5 minutes
  </Step>
  <Step title="3rd retry">
    After 30 minutes
  </Step>
</Steps>

<Note>
  After 3 failed attempts, we stop retrying. Check your webhook logs in the dashboard to debug failures.
</Note>

## Testing

Use tools like [webhook.site](https://webhook.site) or [ngrok](https://ngrok.com) to test your webhook endpoint locally:

```bash
# Expose your local server
ngrok http 3000

# Add the ngrok URL to your webhook endpoints
https://abc123.ngrok.io/webhooks/subscriptions
```

## Rate Limits

<Info>
  - Maximum 10 endpoints per merchant
  - Webhooks must respond within 10 seconds
  - Automatic retry on timeouts or 5xx errors
</Info>

## Getting Help

If you're having trouble with webhooks:

1. Check the **Webhook Logs** tab for detailed error messages
2. Verify your endpoint is publicly accessible
3. Ensure you're verifying signatures correctly
4. Check that your endpoint returns a 2xx status code